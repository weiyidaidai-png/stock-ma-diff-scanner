# A股股票均线差异筛选工具

一个基于Python和Flask的A股股票工具，使用tushare数据获取股票行情，计算长期均值和短期均值的差异，筛选出差异明显的股票，并提供Web界面展示结果和价格走势图。

## 功能特点

- 📊 **数据获取**：获取全部A股列表和前复权日线行情
- 📈 **均值计算**：支持自定义长期均值周期和短期5日均线
- 🔍 **智能筛选**：按差异百分比阈值筛选股票，结果按差异从大到小排序
- 📱 **Web界面**：响应式设计，支持查看筛选结果和价格走势图
- ⚡ **性能优化**：API调用频率控制，数据缓存机制
- 🛡️ **错误处理**：完善的异常处理和用户友好提示

## 技术栈

- **后端**：Python + Flask
- **数据处理**：pandas
- **数据来源**：tushare
- **前端**：HTML + CSS + JavaScript
- **图表库**：ECharts

## 项目结构

```
stock_ma_diff_tool/
├── app.py                 # Flask应用主文件
├── stock_data.py          # 股票数据获取模块
├── stock_analyzer.py      # 股票分析核心逻辑
├── config.py              # 配置文件（tushare token等）
├── templates/
│   └── index.html        # Web页面模板
├── requirements.txt      # 依赖包列表
└── README.md            # 使用说明文档
```

## 安装和配置

### 1. 安装依赖

```bash
# 安装所需的Python库
pip install flask pandas tushare requests python-dateutil numpy
```

### 2. 配置tushare API token

1. 访问 [tushare.pro](https://tushare.pro/register) 免费注册账号
2. 登录后在个人中心获取API token
3. 编辑 `config.py` 文件，将您的API token填入：

```python
# 用户需要配置的参数
TUSHARE_TOKEN = '您的tushare API token'
```

### 3. 启动应用

```bash
# 运行Flask应用
python app.py
```

4. 在浏览器中访问 `http://localhost:5000`

## 使用说明

### 1. 参数配置

- **长期均值周期**：用于计算长期均值的交易日数量（默认20天）
- **差异百分比阈值**：筛选差异大于该阈值的股票（默认5%）

### 2. 开始筛选

1. 填写好参数后，点击"开始筛选"按钮
2. 系统会显示筛选进度和状态
3. 筛选完成后会显示符合条件的股票列表

### 3. 查看结果

- 筛选结果按差异百分比从大到小排序
- 点击股票代码可以查看该股票的价格走势图
- 图表中包含收盘价、5日均线、20日均线和30日均线

### 4. 重置筛选

点击"重置筛选"按钮可以清空当前结果，重新开始新的筛选

## 筛选逻辑

1. **数据获取**：获取全部A股股票列表和对应的前复权日线行情
2. **均值计算**：
   - 长期均值：最近N个交易日的收盘价平均值（N为长期周期参数）
   - 短期均值：最新的5日均线值
3. **差异计算**：`(短期均值 - 长期均值) / 长期均值 * 100%`
4. **筛选排序**：保留差异绝对值大于阈值的股票，按差异绝对值从大到小排序

## 注意事项

1. **tushare API限制**：
   - 免费版API有调用频率限制（每分钟最多500次调用）
   - 大规模筛选可能需要较长时间（约5-10分钟）
   - 建议在非交易时间使用，避免数据更新影响

2. **数据质量**：
   - 个别股票可能因数据缺失无法获取，系统会自动跳过
   - 建议定期更新数据缓存

3. **网络问题**：
   - 网络不稳定时可能出现数据获取失败
   - 系统会自动重试失败的请求

## 常见问题

### Q: 为什么获取不到股票数据？

A: 请检查：
1. tushare API token是否正确配置
2. 网络连接是否正常
3. 是否超过API调用限制

### Q: 筛选结果为空怎么办？

A: 尝试调整参数：
1. 降低差异百分比阈值
2. 调整长期均值周期
3. 检查是否在交易时间使用

### Q: 价格走势图显示不全怎么办？

A: 尝试：
1. 调整浏览器窗口大小
2. 检查网络连接
3. 刷新页面重新加载

## 技术说明

### API调用频率控制

系统会自动控制API调用频率，避免超过tushare的限制：

```python
API_CALL_DELAY = 0.1  # 每次API调用后延迟0.1秒
```

### 数据缓存机制

系统会缓存已获取的股票数据，避免重复API调用，提高效率。

### 后台分析

股票分析在后台线程中进行，避免阻塞Web界面。

## 更新日志

### v1.0.0
- 初始版本
- 支持基本的股票筛选功能
- 提供Web界面和图表展示
- 完善的错误处理机制

## 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情

## 贡献

欢迎提交 Issue 和 Pull Request 来改进项目

## 联系方式

如有问题或建议，请通过以下方式联系：
- 提交 Issue
- 发送邮件

---

**注意**：本工具仅用于学习和研究目的，不构成任何投资建议。股票投资有风险，入市需谨慎。
